<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#0f172a" />
  <title>Mnwab</title>

  <link id="favicon" rel="icon" href="" />

  <style>
    :root {
      --bg: #0f172a;
      --text: #f1f5f9;
      --muted: #94a3b8;
      --border: rgba(71, 85, 105, 0.5);

      --card: rgba(15, 23, 42, 0.95);
      --card2: rgba(30, 41, 59, 0.6);

      --good: #10b981;
      --bad: #ef4444;
      --warn: #f59e0b;

      --primary: #3b82f6;
      --primary-dark: #1e40af;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }

    body {
      margin: 0;
      min-height: 100vh;
      min-height: 100dvh;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      color: var(--text);
      display: grid;
      place-items: center;
      padding: 24px;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    }

    .topbar {
      position: fixed;
      top: 16px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 6;
      display: flex;
      gap: 8px;
      padding: 8px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(8px);
    }

    .tab {
      appearance: none;
      border: none;
      background: transparent;
      color: var(--text);
      font-weight: 500;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease;
      -webkit-tap-highlight-color: transparent;
      opacity: 0.7;
    }

    .tab:hover {
      opacity: 1;
    }

    .tab.active {
      background: var(--primary);
      color: white;
      opacity: 1;
    }

    .card {
      position: relative;
      z-index: 4;
      width: 100%;
      max-width: 700px;
      border-radius: 16px;
      padding: 32px;
      background: var(--card);
      border: 1px solid var(--border);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(8px);
      animation: slideUp 0.4s ease;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .title {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin-bottom: 8px;
      text-align: center;
    }

    .srv-icon {
      width: 48px;
      height: 48px;
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid var(--border);
      object-fit: cover;
    }

    h1 {
      margin: 0;
      font-size: 36px;
      font-weight: 700;
      letter-spacing: -0.5px;
    }

    .byline {
      margin: 8px 0 24px;
      text-align: center;
      color: var(--muted);
      font-size: 14px;
    }

    .section {
      border-radius: 12px;
      padding: 20px;
      background: var(--card2);
      border: 1px solid var(--border);
    }

    .section + .section {
      margin-top: 16px;
    }

    .label {
      color: var(--muted);
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
    }

    .row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .ip {
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 16px;
      font-weight: 600;
      letter-spacing: 0.2px;
      user-select: all;
      word-break: break-word;
      color: var(--primary);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.05);
      font-size: 13px;
      color: var(--muted);
      white-space: nowrap;
    }

    .statusDot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--warn);
      box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
      animation: pulse 2s ease-in-out infinite;
    }

    .statusDot.online {
      background: var(--good);
      box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
    }

    .statusDot.offline {
      background: var(--bad);
      box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
      animation: none;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 0.7; }
      50% { transform: scale(1.2); opacity: 1; }
    }

    .btn {
      width: 100%;
      margin-top: 16px;
      padding: 12px 16px;
      border-radius: 8px;
      border: none;
      font-weight: 600;
      background: var(--primary);
      color: white;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.15s ease;
      -webkit-tap-highlight-color: transparent;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    .btn:hover {
      background: var(--primary-dark);
    }

    .btn:active {
      transform: scale(0.98);
    }

    .subbtn {
      width: 100%;
      margin-top: 12px;
      padding: 10px 14px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.05);
      color: var(--text);
      font-weight: 500;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition: background 0.2s ease, transform 0.15s ease;
    }

    .subbtn:hover {
      background: rgba(255, 255, 255, 0.08);
    }

    .subbtn:active {
      transform: scale(0.98);
    }

    .pill {
      margin-top: 12px;
      padding: 12px 14px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.05);
      font-size: 13px;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .strong {
      color: var(--text);
      font-weight: 600;
    }

    .barWrap {
      margin-top: 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.05);
      padding: 12px 14px;
    }

    .barTop {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 10px;
    }

    .bar {
      height: 8px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.08);
      overflow: hidden;
      border: 1px solid var(--border);
    }

    .fill {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: var(--primary);
      box-shadow: 0 0 12px rgba(59, 130, 246, 0.4);
      transition: width 0.3s ease;
    }

    .motd {
      margin-top: 12px;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.05);
    }

    .motdTitle {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 8px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .motdText {
      color: var(--text);
      font-size: 14px;
      line-height: 1.5;
      white-space: pre-wrap;
      word-break: break-word;
      font-family: 'Monaco', 'Courier New', monospace;
    }

    .toast {
      margin-top: 12px;
      text-align: center;
      font-size: 13px;
      color: var(--muted);
      min-height: 20px;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .toast.show {
      opacity: 1;
    }

    .footer {
      margin-top: 12px;
      text-align: center;
      font-size: 12px;
      color: var(--muted);
    }

    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      margin-top: 16px;
    }

    .modalBack {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      z-index: 7;
      align-items: center;
      justify-content: center;
      padding: 20px;
      backdrop-filter: blur(4px);
    }

    .modalBack.show {
      display: flex;
    }

    .modal {
      width: 100%;
      max-width: 500px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--card);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      padding: 20px;
      animation: slideUp 0.3s ease;
    }

    .modalTop {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 16px;
    }

    .modalTitle {
      font-weight: 600;
      font-size: 16px;
    }

    .closeBtn {
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.05);
      color: var(--text);
      font-weight: 500;
      border-radius: 8px;
      padding: 8px 12px;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition: background 0.2s ease;
    }

    .closeBtn:hover {
      background: rgba(255, 255, 255, 0.08);
    }

    .list {
      border-radius: 8px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.03);
      padding: 8px;
      max-height: 50vh;
      overflow: auto;
    }

    .player {
      padding: 10px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .player + .player {
      border-top: 1px solid var(--border);
    }

    .pname {
      font-weight: 600;
      color: var(--text);
    }

    .puuid {
      color: var(--muted);
      font-size: 12px;
      font-family: monospace;
    }
  </style>
</head>

<body>
  <div class="topbar" role="navigation" aria-label="Navigation">
    <button class="tab active" id="tabHome" type="button">Home</button>
    <button class="tab" id="tabStatus" type="button">Status</button>
  </div>

  <main class="card">
    <div class="title">
      <img class="srv-icon" id="srvIcon" alt="Server icon" />
      <h1>Mnwab</h1>
    </div>
    <div class="byline">by lnvnl</div>

    <!-- HOME PAGE -->
    <section class="page active" id="pageHome">
      <div class="section">
        <div class="label">Server Address</div>

        <div class="row">
          <div class="ip" id="serverIp">BMC.lnvnl.org:25567</div>
          <div class="badge">
            <span class="statusDot" id="statusDotHome" aria-hidden="true"></span>
            <span id="statusTextHome">Checking…</span>
          </div>
        </div>

        <button class="btn" id="copyBtn" type="button">Copy Address</button>

        <div class="barWrap">
          <div class="barTop">
            <span id="playersTextHome">Players: —/—</span>
            <span id="updatedTextHome">Updated: —</span>
          </div>
          <div class="bar"><div class="fill" id="playerFillHome"></div></div>
        </div>

        <div class="pill">
          <span>Version: <span class="strong" id="serverVerHome">—</span></span>
          <span>Latest: <span class="strong" id="latestVerHome">Loading…</span></span>
        </div>

        <div class="motd">
          <div class="motdTitle">Message of the Day</div>
          <div class="motdText" id="motdTextHome">Loading…</div>
        </div>

        <button class="subbtn" id="playersBtnHome" type="button">View Players</button>

        <div class="toast" id="toast"></div>
      </div>
    </section>

    <!-- STATUS PAGE -->
    <section class="page" id="pageStatus">
      <div class="grid">
        <div class="section">
          <div class="label">Connection</div>

          <div class="pill">
            <span>Address: <span class="strong" id="serverIpStatus">BMC.lnvnl.org:25567</span></span>
            <span>Port: <span class="strong" id="serverPortStatus">25567</span></span>
          </div>

          <div class="pill">
            <span>Status: <span class="strong" id="statusTextStatus">Checking…</span></span>
            <span>Players: <span class="strong" id="playersTextStatus">—/—</span></span>
          </div>

          <div class="barWrap">
            <div class="barTop">
              <span>Player Count</span>
              <span id="updatedTextStatus">Updated: —</span>
            </div>
            <div class="bar"><div class="fill" id="playerFillStatus"></div></div>
          </div>

          <div class="pill">
            <span>Server Version: <span class="strong" id="serverVerStatus">—</span></span>
            <span>Latest MC: <span class="strong" id="latestVerStatus">—</span></span>
          </div>

          <button class="subbtn" id="playersBtnStatus" type="button">View Players</button>
        </div>

        <div class="section">
          <div class="label">Message of the Day</div>
          <div class="motdText" id="motdTextStatus">Loading…</div>
        </div>

        <div class="section">
          <div class="label">API Info</div>
          <div class="pill">
            <span>API: <span class="strong">mcsrvstat.us</span></span>
            <span>Cache: <span class="strong" id="apiCache">—</span></span>
          </div>
          <div class="pill">
            <span>Ping: <span class="strong" id="apiPing">—</span></span>
            <span>Query: <span class="strong" id="apiQuery">—</span></span>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Player List Modal -->
  <div class="modalBack" id="modalBack" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Player list">
      <div class="modalTop">
        <div class="modalTitle" id="modalTitle">Players</div>
        <button class="closeBtn" id="closeModal" type="button">Close</button>
      </div>
      <div class="list" id="playerList"></div>
    </div>
  </div>

  <script>
    const SERVER = "BMC.lnvnl.org:25567";

    const favicon = document.getElementById("favicon");
    const srvIcon = document.getElementById("srvIcon");

    const tabHome = document.getElementById("tabHome");
    const tabStatus = document.getElementById("tabStatus");
    const pageHome = document.getElementById("pageHome");
    const pageStatus = document.getElementById("pageStatus");

    const toast = document.getElementById("toast");
    const copyBtn = document.getElementById("copyBtn");

    const statusDotHome = document.getElementById("statusDotHome");
    const statusTextHome = document.getElementById("statusTextHome");
    const playersTextHome = document.getElementById("playersTextHome");
    const updatedTextHome = document.getElementById("updatedTextHome");
    const playerFillHome = document.getElementById("playerFillHome");
    const serverVerHome = document.getElementById("serverVerHome");
    const latestVerHome = document.getElementById("latestVerHome");
    const motdTextHome = document.getElementById("motdTextHome");

    const serverIpStatus = document.getElementById("serverIpStatus");
    const serverPortStatus = document.getElementById("serverPortStatus");
    const statusTextStatus = document.getElementById("statusTextStatus");
    const playersTextStatus = document.getElementById("playersTextStatus");
    const updatedTextStatus = document.getElementById("updatedTextStatus");
    const playerFillStatus = document.getElementById("playerFillStatus");
    const serverVerStatus = document.getElementById("serverVerStatus");
    const latestVerStatus = document.getElementById("latestVerStatus");
    const motdTextStatus = document.getElementById("motdTextStatus");
    const apiCache = document.getElementById("apiCache");
    const apiPing = document.getElementById("apiPing");
    const apiQuery = document.getElementById("apiQuery");

    const playersBtnHome = document.getElementById("playersBtnHome");
    const playersBtnStatus = document.getElementById("playersBtnStatus");

    const modalBack = document.getElementById("modalBack");
    const closeModal = document.getElementById("closeModal");
    const playerList = document.getElementById("playerList");
    const modalTitle = document.getElementById("modalTitle");

    let lastUpdatedAt = null;
    let lastData = null;

    function showToast(msg) {
      toast.textContent = msg;
      toast.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => toast.classList.remove("show"), 900);
    }

    async function copyText(text) {
      try {
        if (navigator.clipboard && window.isSecureContext) {
          await navigator.clipboard.writeText(text);
          return true;
        }
      } catch (e) {}
      try {
        const ta = document.createElement("textarea");
        ta.value = text;
        ta.style.position = "fixed";
        ta.style.left = "-9999px";
        ta.setAttribute("readonly", "");
        document.body.appendChild(ta);
        ta.select();
        const ok = document.execCommand("copy");
        document.body.removeChild(ta);
        return ok;
      } catch (e) {
        return false;
      }
    }

    copyBtn.addEventListener("click", async () => {
      const ok = await copyText(SERVER);
      copyBtn.textContent = ok ? "Copied ✓" : "Copy failed";
      showToast(ok ? "Copied to clipboard" : "Copy blocked");
      setTimeout(() => copyBtn.textContent = "Copy Address", 1150);
    });

    function setActive(page) {
      const isStatus = page === "status";
      pageHome.classList.toggle("active", !isStatus);
      pageStatus.classList.toggle("active", isStatus);
      tabHome.classList.toggle("active", !isStatus);
      tabStatus.classList.toggle("active", isStatus);
    }

    function route() {
      const hash = (location.hash || "").toLowerCase();
      if (hash === "#status") setActive("status");
      else setActive("home");
    }

    tabHome.addEventListener("click", () => {
      location.hash = "";
      route();
    });
    tabStatus.addEventListener("click", () => {
      location.hash = "#status";
      route();
    });
    window.addEventListener("hashchange", route);

    function openModal() {
      modalBack.classList.add("show");
      modalBack.setAttribute("aria-hidden", "false");
    }

    function closeModalFn() {
      modalBack.classList.remove("show");
      modalBack.setAttribute("aria-hidden", "true");
    }

    closeModal.addEventListener("click", closeModalFn);
    modalBack.addEventListener("click", (e) => {
      if (e.target === modalBack) closeModalFn();
    });
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeModalFn();
    });

    function escapeHtml(str) {
      return String(str).replace(/[&<>"']/g, s => ({
        "&": "&amp;",
        "<": "&lt;",
        ">": "&gt;",
        '"': "&quot;",
        "'": "&#39;"
      }[s]));
    }

    function renderPlayers() {
      playerList.innerHTML = "";
      const list = lastData?.players?.list || [];
      const online = lastData?.players?.online ?? 0;
      modalTitle.textContent = `Players (${online})`;

      if (!lastData?.online) {
        playerList.innerHTML = `<div class="player"><div class="pname">Server is offline</div></div>`;
        return;
      }
      if (list.length === 0) {
        playerList.innerHTML = `<div class="player"><div class="pname">No player list available</div><div class="puuid">Some servers hide this information</div></div>`;
        return;
      }

      for (const p of list) {
        const row = document.createElement("div");
        row.className = "player";
        row.innerHTML = `
          <div>
            <div class="pname">${escapeHtml(p.name || "Player")}</div>
            <div class="puuid">${escapeHtml(p.uuid || "")}</div>
          </div>
          <div class="badge">Online</div>
        `;
        playerList.appendChild(row);
      }
    }

    playersBtnHome.addEventListener("click", () => {
      renderPlayers();
      openModal();
    });
    playersBtnStatus.addEventListener("click", () => {
      renderPlayers();
      openModal();
    });

    async function fetchJsonWithTimeout(url, ms = 6500) {
      const controller = new AbortController();
      const t = setTimeout(() => controller.abort(), ms);
      try {
        const res = await fetch(url, { cache: "no-store", signal: controller.signal });
        if (!res.ok) throw new Error("Bad response");
        return await res.json();
      } finally {
        clearTimeout(t);
      }
    }

    function setStatus(dotEl, textEl, state) {
      dotEl.classList.remove("online", "offline");
      if (state === true) {
        dotEl.classList.add("online");
        textEl.textContent = "Online";
      } else if (state === false) {
        dotEl.classList.add("offline");
        textEl.textContent = "Offline";
      } else {
        textEl.textContent = "Checking…";
      }
    }

    function setUpdatedLabel(el) {
      if (!lastUpdatedAt) {
        el.textContent = "Updated: —";
        return;
      }
      const s = Math.max(0, Math.floor((Date.now() - lastUpdatedAt) / 1000));
      if (s < 10) el.textContent = "Updated: just now";
      else if (s < 60) el.textContent = `Updated: ${s}s ago`;
      else el.textContent = `Updated: ${Math.floor(s / 60)}m ago`;
    }

    function formatMotd(d) {
      const clean = d?.motd?.clean;
      if (Array.isArray(clean) && clean.length) return clean.join("\n");
      const raw = d?.motd?.raw;
      if (Array.isArray(raw) && raw.length) return raw.join("\n");
      return "—";
    }

    async function loadStatus() {
      setStatus(statusDotHome, statusTextHome, null);
      statusTextStatus.textContent = "Checking…";

      try {
        const d = await fetchJsonWithTimeout(`https://api.mcsrvstat.us/3/${SERVER}`, 6500);
        lastData = d;
        lastUpdatedAt = Date.now();

        const online = !!d.online;
        setStatus(statusDotHome, statusTextHome, online);
        statusTextStatus.textContent = online ? "Online" : "Offline";

        const on = d?.players?.online ?? 0;
        const max = d?.players?.max ?? 0;

        playersTextHome.textContent = `Players: ${on}/${max || "—"}`;
        playersTextStatus.textContent = `${on}/${max || "—"}`;

        let pct = 0;
        if (max && max > 0) pct = Math.min(100, Math.round((on / max) * 100));
        playerFillHome.style.width = pct + "%";
        playerFillStatus.style.width = pct + "%";

        const ver = d?.protocol?.name || d?.version || "—";
        serverVerHome.textContent = ver;
        serverVerStatus.textContent = ver;

        const motd = formatMotd(d);
        motdTextHome.textContent = motd;
        motdTextStatus.textContent = motd;

        apiCache.textContent = d?.debug?.cachehit ? "hit" : "miss";
        apiPing.textContent = d?.debug?.ping ? "ok" : "no";
        apiQuery.textContent = d?.debug?.query ? "ok" : "no";

        serverIpStatus.textContent = SERVER;
        serverPortStatus.textContent = String(d?.port ?? 25567);

        const hasList = Array.isArray(d?.players?.list) && d.players.list.length > 0;
        const hint = online ? (hasList ? "Available" : "May be hidden") : "Offline";
        playersBtnHome.textContent = `View Players (${hint})`;
        playersBtnStatus.textContent = `View Players (${hint})`;

      } catch {
        statusTextHome.textContent = "Unavailable";
        statusTextStatus.textContent = "Unavailable";
        playersTextHome.textContent = "Players: —/—";
        playersTextStatus.textContent = "—/—";
        playerFillHome.style.width = "0%";
        playerFillStatus.style.width = "0%";
        serverVerHome.textContent = "—";
        serverVerStatus.textContent = "—";
        motdTextHome.textContent = "Could not load (network/API blocked)";
        motdTextStatus.textContent = "Could not load (network/API blocked)";
        apiCache.textContent = "—";
        apiPing.textContent = "—";
        apiQuery.textContent = "—";
      }

      setUpdatedLabel(updatedTextHome);
      setUpdatedLabel(updatedTextStatus);
    }

    async function loadLatest() {
      try {
        const j = await fetchJsonWithTimeout("https://piston-meta.mojang.com/mc/game/version_manifest_v2.json", 6500);
        const latest = j?.latest?.release || "Latest";
        latestVerHome.textContent = latest;
        latestVerStatus.textContent = latest;
      } catch {
        latestVerHome.textContent = "Latest";
        latestVerStatus.textContent = "Latest";
      }
    }

    function setIcon() {
      const url = `https://api.mcsrvstat.us/icon/${SERVER}`;
      srvIcon.src = url;
      favicon.href = url;
      srvIcon.onerror = () => srvIcon.style.display = "none";
    }

    route();
    setIcon();
    loadStatus();
    loadLatest();

    setInterval(loadStatus, 120000);
    setInterval(loadLatest, 120000);
    setInterval(() => {
      setUpdatedLabel(updatedTextHome);
      setUpdatedLabel(updatedTextStatus);
    }, 1000);
  </script>
</body>
</html>
