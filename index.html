<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#0a0a0a" />
  <title>Mnwab</title>

  <link id="favicon" rel="icon" href="" />

  <style>
    :root {
      /* base */
      --bg: #0a0a0a;
      --bg2: #0b0f0c;
      --text: rgba(245,245,247,.95);
      --muted: rgba(245,245,247,.58);
      --border: rgba(255, 255, 255, 0.10);

      /* surfaces (iOS-ish) */
      --card: rgba(18, 18, 18, 0.72);
      --card2: rgba(255, 255, 255, 0.045);
      --glass: rgba(18,18,18,.55);

      /* accents: muted sage + slight blue */
      --sage: #7f9b74;
      --sage2: #6f8d66;
      --blue: #6aa7d8;

      /* status */
      --good: #8fb573;
      --bad: #ff453a;
      --warn: #ff9f0a;

      /* radii */
      --r-lg: 22px;
      --r-md: 16px;
      --r-sm: 12px;

      /* shadows (keep subtle) */
      --sh-card: 0 18px 55px rgba(0,0,0,.55);
      --sh-soft: 0 10px 30px rgba(0,0,0,.35);
      --sh-inset: inset 0 1px 0 rgba(255,255,255,.06);

      /* focus */
      --ring: rgba(127,155,116,.65);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }

    body {
      margin: 0;
      min-height: 100vh;
      min-height: 100dvh;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      color: var(--text);
      display: grid;
      place-items: center;
      padding: calc(18px + env(safe-area-inset-top)) 16px calc(22px + env(safe-area-inset-bottom));
      background:
        radial-gradient(1200px 760px at 50% 0%, rgba(127,155,116,.12), transparent 62%),
        radial-gradient(900px 600px at 15% 10%, rgba(127,155,116,.24), transparent 60%),
        radial-gradient(850px 560px at 85% 14%, rgba(106,167,216,.14), transparent 62%),
        radial-gradient(820px 620px at 12% 78%, rgba(127,155,116,.10), transparent 65%),
        radial-gradient(900px 700px at 55% 100%, rgba(127,155,116,.14), transparent 65%),
        linear-gradient(180deg, var(--bg) 0%, var(--bg2) 100%);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* subtle grain so it feels less “flat” */
    body::before{
      content:"";
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: .12;
      mix-blend-mode: overlay;
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='2'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
    }

    
    /* subtle vignette + top glow (static, no lag) */
    body::after{
      content:"";
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: .85;
      background:
        radial-gradient(1000px 620px at 50% -12%, rgba(255,255,255,.06), transparent 60%),
        radial-gradient(900px 720px at 50% 120%, rgba(0,0,0,.55), transparent 55%),
        radial-gradient(1400px 900px at 50% 50%, transparent 45%, rgba(0,0,0,.55) 100%);
    }
.topbar {
      position: fixed;
      top: calc(14px + env(safe-area-inset-top));
      left: 50%;
      transform: translateX(-50%);
      z-index: 6;
      display: flex;
      gap: 6px;
      padding: 6px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(127,155,116,.08), rgba(20, 20, 20, 0.55));
      backdrop-filter: blur(22px);
      box-shadow: var(--sh-soft);
      user-select: none;
    }

    .tab {
      appearance: none;
      position: relative;
      border: none;
      background: transparent;
      color: var(--muted);
      font-weight: 600;
      font-size: 14px;
      padding: 10px 16px;
      border-radius: 999px;
      cursor: pointer;
      transition: transform .12s ease, background .18s ease, color .18s ease;
      -webkit-tap-highlight-color: transparent;
      letter-spacing: -0.1px;
    }

    .tab:hover {
      color: var(--text);
      background: rgba(255, 255, 255, 0.06);
    }
    .tab:active { transform: scale(0.98); }


    .tab:focus-visible{
      outline: 3px solid rgba(127,155,116,.55);
      outline-offset: 2px;
    }

    .tab.active::after{
      content:"";
      position:absolute;
      inset: 0;
      border-radius: inherit;
      pointer-events:none;
      background: radial-gradient(160px 60px at 50% 0%, rgba(255,255,255,.22), transparent 60%);
    }

    .tab.active {
      background: linear-gradient(180deg, rgba(127,155,116,.95), rgba(111,141,102,.90));
      color: rgba(10,10,10,.92);
      box-shadow: var(--sh-inset);
    }

    .card {
      position: relative;
      z-index: 4;
      width: 100%;
      max-width: 740px;
      border-radius: var(--r-lg);
      padding: 28px;
      background:
        radial-gradient(900px 240px at 50% 0%, rgba(127,155,116,.10), transparent 58%),
        linear-gradient(180deg, rgba(22, 22, 22, 0.72), rgba(12, 12, 12, 0.55));
      border: 1px solid rgba(255, 255, 255, 0.10);
      box-shadow: var(--sh-card);
      backdrop-filter: blur(26px);
      margin-top: 64px; /* space for topbar */
      animation: slideUp 0.35s ease;
    }

    /* soft top highlight like iOS cards */
    .card::before{
      content:"";
      position:absolute;
      inset: 0;
      border-radius: inherit;
      pointer-events:none;
      background: radial-gradient(900px 240px at 50% 0%, rgba(255,255,255,.08), transparent 55%);
    }

    
    .card::after{
      content:"";
      position:absolute;
      inset: -1px;
      border-radius: inherit;
      pointer-events:none;
      background: radial-gradient(900px 240px at 50% 0%, rgba(127,155,116,.18), transparent 60%);
      opacity: .8;
    }

@keyframes slideUp {
      from { opacity: 0; transform: translateY(12px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .title {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 14px;
      margin-bottom: 6px;
      text-align: center;
    }

    .srv-icon {
      width: 52px;
      height: 52px;
      border-radius: 14px;
      background: linear-gradient(180deg, rgba(127,155,116,.07), rgba(255,255,255,.035));
      border: 1px solid rgba(255,255,255,.10);
      object-fit: cover;
      box-shadow: 0 10px 22px rgba(0,0,0,.25);
    }

    h1 {
      margin: 0;
      font-size: 32px;
      font-weight: 750;
      letter-spacing: -0.7px;
      color: var(--text);
          text-shadow: 0 0 18px rgba(127,155,116,.14);
    }

    .byline {
      margin: 8px 0 22px;
      text-align: center;
      color: var(--muted);
      font-size: 14px;
      font-weight: 500;
    }

    .section {
      border-radius: var(--r-lg);
      padding: 18px;
      background: linear-gradient(180deg, rgba(127,155,116,.07), rgba(255,255,255,.035));
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: var(--sh-inset);
    }
    .section + .section { margin-top: 14px; }

    .label {
      color: rgba(245,245,247,.55);
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.9px;
      margin-bottom: 12px;
    }

    .row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 14px;
      flex-wrap: wrap;
    }

    .ip {
      font-family: ui-monospace, "SF Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 15px;
      font-weight: 650;
      user-select: all;
      word-break: break-word;
      color: rgba(245,245,247,.92);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(127,155,116,.10), rgba(0,0,0,.14));
      font-size: 13px;
      font-weight: 650;
      color: rgba(245,245,247,.70);
      white-space: nowrap;
      backdrop-filter: blur(16px);
    }

    .statusDot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
      background: var(--warn);
      box-shadow: 0 0 0 4px rgba(255,159,10,.10);
      animation: pulse 2s ease-in-out infinite;
    }
    .statusDot.online {
      background: var(--good);
      box-shadow: 0 0 0 4px rgba(143,181,115,.10);
    }
    .statusDot.offline {
      background: var(--bad);
      box-shadow: 0 0 0 4px rgba(255,69,58,.10);
      animation: none;
    }

    @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.55; } }

    .btn {
      width: 100%;
      margin-top: 14px;
      padding: 12px 18px;
      border-radius: 14px;
      border: 1px solid rgba(127,155,116,.30);
      font-weight: 750;
      font-size: 15px;
      background: linear-gradient(180deg, rgba(127,155,116,.95), rgba(111,141,102,.92));
      color: rgba(10,10,10,.92);
      cursor: pointer;
      transition: transform .12s ease, filter .18s ease;
      -webkit-tap-highlight-color: transparent;
      box-shadow: 0 12px 26px rgba(127,155,116,.16);
    }
    .btn:hover { filter: brightness(1.03); }
    .btn:active { transform: scale(0.985); }
    .btn:focus-visible { outline: 3px solid var(--ring); outline-offset: 2px; }

    .subbtn {
      width: 100%;
      margin-top: 14px;
      padding: 12px 18px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.045);
      color: var(--text);
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition: transform .12s ease, background .18s ease;
      backdrop-filter: blur(18px);
    }
    .subbtn:hover { background: rgba(255,255,255,.07); }
    .subbtn:active { transform: scale(0.985); }
    .subbtn:focus-visible { outline: 3px solid rgba(106,167,216,.55); outline-offset: 2px; }


    /* hover sheen (only on hover, no constant animation) */
    .btn, .subbtn{
      position: relative;
      overflow: hidden;
      transform: translateZ(0);
    }
    .btn::after, .subbtn::after{
      content:"";
      position:absolute;
      inset: -2px;
      background: linear-gradient(120deg,
        transparent 0%,
        rgba(255,255,255,.28) 48%,
        transparent 60%
      );
      transform: translateX(-130%);
      transition: transform .7s ease;
      opacity: .75;
      pointer-events:none;
    }
    .btn:hover::after, .subbtn:hover::after{ transform: translateX(130%); }
    .btn:hover{
      transform: translateY(-1px);
      box-shadow: 0 16px 34px rgba(127,155,116,.14);
      filter: brightness(1.02);
    }
    .btn:active{ transform: translateY(0) scale(.995); }
    .pill {
      margin-top: 14px;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(127,155,116,.06), rgba(0,0,0,.16));
      font-size: 13px;
      color: rgba(245,245,247,.65);
      display: flex;
      justify-content: space-between;
      gap: 14px;
      flex-wrap: wrap;
      backdrop-filter: blur(16px);
    }

    .strong {
      color: rgba(245,245,247,.92);
      font-weight: 750;
    }

    .barWrap {
      margin-top: 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
      padding: 14px;
      backdrop-filter: blur(16px);
    }

    .barTop {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      font-size: 13px;
      color: rgba(245,245,247,.62);
      margin-bottom: 10px;
      font-weight: 650;
    }

    .bar {
      height: 9px;
      border-radius: 999px;
      background: rgba(255,255,255,.07);
      overflow: hidden;
    }

    .fill {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(127,155,116,.95), rgba(106,167,216,.65));
      transition: width 0.28s ease;
    }

    .motd {
      margin-top: 14px;
      padding: 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
      backdrop-filter: blur(16px);
    }

    .motdTitle {
      font-size: 12px;
      color: rgba(245,245,247,.55);
      margin-bottom: 10px;
      font-weight: 750;
      text-transform: uppercase;
      letter-spacing: 0.95px;
    }

    .motdText {
      color: rgba(245,245,247,.90);
      font-size: 13px;
      line-height: 1.6;
      white-space: pre-wrap;
      word-break: break-word;
      font-family: ui-monospace, "SF Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    /* Uptime dots (last checks) */
    .uptime {
      margin-top: 14px;
      padding: 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
      backdrop-filter: blur(16px);
    }
    .uptimeTop{
      display:flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .uptimeTitle{
      font-size: 12px;
      color: rgba(245,245,247,.55);
      font-weight: 750;
      text-transform: uppercase;
      letter-spacing: 0.95px;
    }
    .uptimeMeta{
      font-size: 12px;
      color: rgba(245,245,247,.55);
      font-weight: 650;
      white-space: nowrap;
    }
    .dots{
      display:flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items:center;
    }
    .dot{
      width: 10px;
      height: 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(245,245,247,.10);
      box-shadow: 0 0 0 0 rgba(127,155,116,0);
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .dot.online{
      background: rgba(127,155,116,.72);
      border-color: rgba(127,155,116,.45);
      box-shadow: 0 0 0 6px rgba(127,155,116,.08);
    }
    .dot.offline{
      background: rgba(235,95,106,.70);
      border-color: rgba(235,95,106,.40);
      box-shadow: 0 0 0 6px rgba(235,95,106,.07);
    }
    .dot.unknown{
      background: rgba(245,245,247,.12);
      border-color: rgba(245,245,247,.14);
      box-shadow: none;
    }

.dot.empty{
  background: rgba(245,245,247,.06);
  border-color: rgba(255,255,255,.10);
  box-shadow: none;
  opacity: .55;
}

    .dot:last-child{
      transform: scale(1.08);
    }


    .toast {
      margin-top: 14px;
      text-align: center;
      font-size: 13px;
      color: rgba(245,245,247,.65);
      min-height: 18px;
      opacity: 0;
      transform: translateY(-4px);
      filter: blur(6px);
      transition: opacity .18s ease, transform .18s ease, filter .18s ease;
    }
    .toast.show {
      opacity: 1;
      transform: translateY(0);
      filter: blur(0);
    }
.footer {
      margin-top: 14px;
      text-align: center;
      font-size: 12px;
      color: rgba(245,245,247,.50);
      font-weight: 500;
    }

    .page { display: none; }
    .page.active { display: block; }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 14px;
      margin-top: 14px;
    }

    .modalBack {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.55);
      display: none;
      z-index: 7;
      align-items: center;
      justify-content: center;
      padding: 16px;
      backdrop-filter: blur(20px);
      animation: fadeIn 0.16s ease;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .modalBack.show { display: flex; }

    .modal {
      width: 100%;
      max-width: 520px;
      border-radius: var(--r-lg);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(18,18,18,.75);
      box-shadow: var(--sh-card);
      padding: 20px;
      animation: modalIn 0.18s ease;
      backdrop-filter: blur(26px);
    }
    @keyframes modalIn {
      from { opacity: 0; transform: translateY(10px) scale(0.98); }
      to   { opacity: 1; transform: translateY(0) scale(1); }
    }

    .modalTop {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 14px;
    }

    .modalTitle {
      font-weight: 800;
      font-size: 16px;
      letter-spacing: -0.2px;
    }

    .closeBtn {
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      color: var(--text);
      font-weight: 750;
      font-size: 13px;
      border-radius: 999px;
      padding: 8px 12px;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition: transform .12s ease, background .18s ease;
    }
    .closeBtn:hover { background: rgba(255,255,255,.08); }
    .closeBtn:active { transform: scale(0.985); }
    .closeBtn:focus-visible { outline: 3px solid rgba(106,167,216,.55); outline-offset: 2px; }

    .list {
      border-radius: var(--r-md);
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      padding: 6px;
      max-height: 50vh;
      overflow: auto;
      scrollbar-width: thin;
      scrollbar-color: rgba(255, 255, 255, 0.12) transparent;
    }

    .list::-webkit-scrollbar { width: 6px; }
    .list::-webkit-scrollbar-track { background: transparent; }
    .list::-webkit-scrollbar-thumb { background: rgba(255,255,255,.12); border-radius: 999px; }
    .list::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,.18); }

    .player {
      padding: 12px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 14px;
    }
    .player + .player {
      border-top: 1px solid rgba(255,255,255,.08);
      padding-top: 12px;
      margin-top: 0;
    }

    .pname {
      font-weight: 800;
      font-size: 14px;
      color: rgba(245,245,247,.92);
      letter-spacing: -0.1px;
    }

    .puuid {
      color: rgba(245,245,247,.55);
      font-size: 11px;
      font-family: ui-monospace, "SF Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      margin-top: 4px;
    }

    @media (max-width: 520px){
      .card { padding: 18px; margin-top: 68px; }
      h1 { font-size: 28px; }
      .srv-icon { width: 48px; height: 48px; border-radius: 13px; }
      .tab { padding: 10px 14px; }
    }

    @media (prefers-reduced-motion: reduce){
      * { animation: none !important; transition: none !important; }
    }
  </style>
</head>

<body>
  <div class="topbar" role="navigation" aria-label="Navigation">
    <button class="tab active" id="tabHome" type="button">Home</button>
    <button class="tab" id="tabStatus" type="button">Status</button>
  </div>

  <main class="card">
    <div class="title">
      <img class="srv-icon" id="srvIcon" alt="Server icon" />
      <h1>Mnwab</h1>
    </div>
    <div class="byline">by lnvnl</div>

    <!-- HOME PAGE -->
    <section class="page active" id="pageHome">
      <div class="section">
        <div class="label">Server Address</div>

        <div class="row">
          <div class="ip" id="serverIp">BMC.lnvnl.org:25567</div>
          <div style="display: flex; gap: 8px; flex-wrap: wrap; align-items: center;">
            <div class="badge">
              <span class="statusDot" id="statusDotHome" aria-hidden="true"></span>
              <span id="statusTextHome">Checking…</span>
            </div>
            <div class="badge" id="pingBadgeHome">Ping: —</div>
          </div>
        </div>

        <button class="btn" id="copyBtn" type="button">Copy Address</button>

        <div class="barWrap">
          <div class="barTop">
            <span id="playersTextHome">Players: —/—</span>
            <span id="updatedTextHome">Updated: —</span>
          </div>
          <div class="bar"><div class="fill" id="playerFillHome"></div></div>
        </div>

        <div class="pill">
          <span>Version: <span class="strong" id="serverVerHome">—</span></span>
          <span>Latest: <span class="strong" id="latestVerHome">Loading…</span></span>
        </div>

        <div class="motd">
          <div class="motdTitle">Message of the Day</div>
          <div class="motdText" id="motdTextHome">Loading…</div>
        </div>

        
        <div class="uptime" aria-label="Uptime last checks">
          <div class="uptimeTop">
            <div class="uptimeTitle">Uptime (last 24)</div>
            <div class="uptimeMeta" id="uptimeMetaHome">—</div>
          </div>
          <div class="dots" id="uptimeDotsHome"></div>
        </div>

<button class="subbtn" id="playersBtnHome" type="button">View Players</button>

        <div class="toast" id="toast"></div>
      </div>
    </section>

    <!-- STATUS PAGE -->
    <section class="page" id="pageStatus">
      <div class="grid">
        <div class="section">
          <div class="label">Connection</div>

          <div class="pill">
            <span>Address: <span class="strong" id="serverIpStatus">BMC.lnvnl.org:25567</span></span>
            <span>Port: <span class="strong" id="serverPortStatus">25567</span></span>
          </div>

          <div class="pill">
            <span>Status: <span class="strong" id="statusTextStatus">Checking…</span></span>
            <span>Players: <span class="strong" id="playersTextStatus">—/—</span></span>
          </div>

          <div class="barWrap">
            <div class="barTop">
              <span>Player Count</span>
              <span id="updatedTextStatus">Updated: —</span>
            </div>
            <div class="bar"><div class="fill" id="playerFillStatus"></div></div>
          </div>

          <div class="pill">
            <span>Server Version: <span class="strong" id="serverVerStatus">—</span></span>
            <span>Latest MC: <span class="strong" id="latestVerStatus">—</span></span>
          </div>

          <button class="subbtn" id="playersBtnStatus" type="button">View Players</button>
        </div>

        <div class="section">
          <div class="label">Message of the Day</div>
          <div class="motdText" id="motdTextStatus">Loading…</div>
        </div>

        
        <div class="section">
          <div class="label">Uptime</div>
          <div class="uptime">
            <div class="uptimeTop">
              <div class="uptimeTitle">Last 24 checks</div>
              <div class="uptimeMeta" id="uptimeMetaStatus">—</div>
            </div>
            <div class="dots" id="uptimeDotsStatus"></div>
          </div>
        </div>

<div class="section">
          <div class="label">API Info</div>
          <div class="pill">
            <span>API: <span class="strong">mcsrvstat.us</span></span>
            <span>Cache: <span class="strong" id="apiCache">—</span></span>
          </div>
          <div class="pill">
            <span>Ping: <span class="strong" id="apiPing">—</span></span>
            <span>Query: <span class="strong" id="apiQuery">—</span></span>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Player List Modal -->
  <div class="modalBack" id="modalBack" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Player list">
      <div class="modalTop">
        <div class="modalTitle" id="modalTitle">Players</div>
        <button class="closeBtn" id="closeModal" type="button">Close</button>
      </div>
      <div class="list" id="playerList"></div>
    </div>
  </div>

  <script>
    const SERVER = "BMC.lnvnl.org:25567";

    const favicon = document.getElementById("favicon");
    const srvIcon = document.getElementById("srvIcon");

    const tabHome = document.getElementById("tabHome");
    const tabStatus = document.getElementById("tabStatus");
    const pageHome = document.getElementById("pageHome");
    const pageStatus = document.getElementById("pageStatus");

    const toast = document.getElementById("toast");
    const copyBtn = document.getElementById("copyBtn");

    const statusDotHome = document.getElementById("statusDotHome");
    const statusTextHome = document.getElementById("statusTextHome");
    const playersTextHome = document.getElementById("playersTextHome");
    const updatedTextHome = document.getElementById("updatedTextHome");
    const playerFillHome = document.getElementById("playerFillHome");
    const serverVerHome = document.getElementById("serverVerHome");
    const latestVerHome = document.getElementById("latestVerHome");
    const motdTextHome = document.getElementById("motdTextHome");
    const pingBadgeHome = document.getElementById("pingBadgeHome");

    const serverIpStatus = document.getElementById("serverIpStatus");
    const serverPortStatus = document.getElementById("serverPortStatus");
    const statusTextStatus = document.getElementById("statusTextStatus");
    const playersTextStatus = document.getElementById("playersTextStatus");
    const updatedTextStatus = document.getElementById("updatedTextStatus");
    const playerFillStatus = document.getElementById("playerFillStatus");
    const serverVerStatus = document.getElementById("serverVerStatus");
    const latestVerStatus = document.getElementById("latestVerStatus");
    const motdTextStatus = document.getElementById("motdTextStatus");
    const uptimeDotsHome = document.getElementById("uptimeDotsHome");
    const uptimeMetaHome = document.getElementById("uptimeMetaHome");
    const uptimeDotsStatus = document.getElementById("uptimeDotsStatus");
    const uptimeMetaStatus = document.getElementById("uptimeMetaStatus");

    const apiCache = document.getElementById("apiCache");
    const apiPing = document.getElementById("apiPing");
    const apiQuery = document.getElementById("apiQuery");

    const playersBtnHome = document.getElementById("playersBtnHome");
    const playersBtnStatus = document.getElementById("playersBtnStatus");

    const modalBack = document.getElementById("modalBack");
    const closeModal = document.getElementById("closeModal");
    const playerList = document.getElementById("playerList");
    const modalTitle = document.getElementById("modalTitle");

    let lastUpdatedAt = null;
    let lastData = null;


    
// Uptime dots (GLOBAL)
// Your old uptime was different per device because it used localStorage (browser storage is per device/account).
// To make it identical everywhere + update hourly even when nobody visits, use a tiny shared endpoint.
// Recommended: Cloudflare Worker + KV with an hourly Cron trigger.
//
// Endpoint format (GET):
//   { updated: <epoch_ms>, checks: [ { t:<epoch_ms>, s:1|0 } ] }   // keep last 24
//
const UPTIME_ENDPOINT = ""; // e.g. "https://your-worker.yourname.workers.dev/uptime"
const HISTORY_MAX = 24;

function fmtAgo(ts) {
  if (!ts) return "—";
  const s = Math.max(0, Math.floor((Date.now() - ts) / 1000));
  if (s < 60) return `${s}s ago`;
  const m = Math.floor(s / 60);
  if (m < 60) return `${m}m ago`;
  const h = Math.floor(m / 60);
  return `${h}h ago`;
}

function renderUptimeFromChecks(checks, updatedTs) {
  const shown = Array.isArray(checks) ? checks.slice(-HISTORY_MAX) : [];

  function fill(elDots, elMeta) {
    if (!elDots || !elMeta) return;

    elDots.innerHTML = "";

    // make sure we always show exactly 24 dots
    const pad = Math.max(0, HISTORY_MAX - shown.length);

    let on = 0, off = 0;

    // left padding (empty dots)
    for (let i = 0; i < pad; i++) {
      const dot = document.createElement("span");
      dot.className = "dot empty";
      dot.title = "No data";
      elDots.appendChild(dot);
    }

    for (const it of shown) {
      const state = it?.s;
      if (state === 1) on++;
      else if (state === 0) off++;

      const dot = document.createElement("span");
      dot.className = "dot " + (state === 1 ? "online" : state === 0 ? "offline" : "unknown");

      const when = it?.t ? new Date(it.t) : null;
      dot.title = `${state === 1 ? "Online" : state === 0 ? "Offline" : "Unknown"} • ${when ? when.toLocaleString() : "—"}`;

      elDots.appendChild(dot);
    }

    const denom = on + off;
    if (!shown.length) {
      elMeta.textContent = UPTIME_ENDPOINT ? `No data yet • updated ${fmtAgo(updatedTs)}` : "Set UPTIME_ENDPOINT for global uptime";
    } else if (!denom) {
      elMeta.textContent = `No signal • updated ${fmtAgo(updatedTs)}`;
    } else {
      const pct = Math.round((on / denom) * 100);
      elMeta.textContent = `${pct}% online • ${on}/${denom} • updated ${fmtAgo(updatedTs)}`;
    }
  }

  fill(uptimeDotsHome, uptimeMetaHome);
  fill(uptimeDotsStatus, uptimeMetaStatus);
}

async function fetchUptimeHistory() {
  if (!UPTIME_ENDPOINT) {
    return { updated: null, checks: [] };
  }
  try {
    const r = await fetch(UPTIME_ENDPOINT, { cache: "no-store" });
    if (!r.ok) throw new Error(`HTTP ${r.status}`);
    const j = await r.json();
    const checks = Array.isArray(j?.checks) ? j.checks : [];
    const updated = typeof j?.updated === "number" ? j.updated : (checks.length ? checks[checks.length - 1]?.t : null);
    return { updated, checks };
  } catch (e) {
    return { updated: null, checks: [] };
  }
}

async function renderUptime() {
  const { updated, checks } = await fetchUptimeHistory();
  renderUptimeFromChecks(checks, updated);
}

function showToast(msg) {
      toast.textContent = msg;
      toast.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => toast.classList.remove("show"), 900);
    }

    async function copyText(text) {
      try {
        if (navigator.clipboard && window.isSecureContext) {
          await navigator.clipboard.writeText(text);
          return true;
        }
      } catch (e) {}
      try {
        const ta = document.createElement("textarea");
        ta.value = text;
        ta.style.position = "fixed";
        ta.style.left = "-9999px";
        ta.setAttribute("readonly", "");
        document.body.appendChild(ta);
        ta.select();
        const ok = document.execCommand("copy");
        document.body.removeChild(ta);
        return ok;
      } catch (e) {
        return false;
      }
    }

    copyBtn.addEventListener("click", async () => {
      const ok = await copyText(SERVER);
      copyBtn.textContent = ok ? "Copied ✓" : "Copy failed";
      showToast(ok ? "Copied to clipboard" : "Copy blocked");
      setTimeout(() => copyBtn.textContent = "Copy Address", 1150);
    });

    function setActive(page) {
      const isStatus = page === "status";
      pageHome.classList.toggle("active", !isStatus);
      pageStatus.classList.toggle("active", isStatus);
      tabHome.classList.toggle("active", !isStatus);
      tabStatus.classList.toggle("active", isStatus);
    }

    function route() {
      const hash = (location.hash || "").toLowerCase();
      if (hash === "#status") setActive("status");
      else setActive("home");
    }

    tabHome.addEventListener("click", () => {
      location.hash = "";
      route();
    });
    tabStatus.addEventListener("click", () => {
      location.hash = "#status";
      route();
    });
    window.addEventListener("hashchange", route);

    function openModal() {
      modalBack.classList.add("show");
      modalBack.setAttribute("aria-hidden", "false");
    }

    function closeModalFn() {
      modalBack.classList.remove("show");
      modalBack.setAttribute("aria-hidden", "true");
    }

    closeModal.addEventListener("click", closeModalFn);
    modalBack.addEventListener("click", (e) => {
      if (e.target === modalBack) closeModalFn();
    });
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeModalFn();
    });

    function escapeHtml(str) {
      return String(str).replace(/[&<>"']/g, s => ({
        "&": "&amp;",
        "<": "&lt;",
        ">": "&gt;",
        '"': "&quot;",
        "'": "&#39;"
      }[s]));
    }

    function renderPlayers() {
      playerList.innerHTML = "";
      const list = lastData?.players?.list || [];
      const online = lastData?.players?.online ?? 0;
      modalTitle.textContent = `Players (${online})`;

      if (!lastData?.online) {
        playerList.innerHTML = `<div class="player"><div class="pname">Server is offline</div></div>`;
        return;
      }
      if (list.length === 0) {
        playerList.innerHTML = `<div class="player"><div class="pname">No player list available</div><div class="puuid">Some servers hide this information</div></div>`;
        return;
      }

      for (const p of list) {
        const row = document.createElement("div");
        row.className = "player";
        row.innerHTML = `
          <div>
            <div class="pname">${escapeHtml(p.name || "Player")}</div>
            <div class="puuid">${escapeHtml(p.uuid || "")}</div>
          </div>
          <div class="badge">Online</div>
        `;
        playerList.appendChild(row);
      }
    }

    playersBtnHome.addEventListener("click", () => {
      renderPlayers();
      openModal();
    });
    playersBtnStatus.addEventListener("click", () => {
      renderPlayers();
      openModal();
    });

    async function fetchJsonWithTimeout(url, ms = 6500) {
      const controller = new AbortController();
      const t = setTimeout(() => controller.abort(), ms);
      try {
        const res = await fetch(url, { cache: "no-store", signal: controller.signal });
        if (!res.ok) throw new Error("Bad response");
        return await res.json();
      } finally {
        clearTimeout(t);
      }
    }

    function setStatus(dotEl, textEl, state) {
      dotEl.classList.remove("online", "offline");
      if (state === true) {
        dotEl.classList.add("online");
        textEl.textContent = "Online";
      } else if (state === false) {
        dotEl.classList.add("offline");
        textEl.textContent = "Offline";
      } else {
        textEl.textContent = "Checking…";
      }
    }

    function setUpdatedLabel(el) {
      if (!lastUpdatedAt) {
        el.textContent = "Updated: —";
        return;
      }
      const s = Math.max(0, Math.floor((Date.now() - lastUpdatedAt) / 1000));
      if (s < 10) el.textContent = "Updated: just now";
      else if (s < 60) el.textContent = `Updated: ${s}s ago`;
      else el.textContent = `Updated: ${Math.floor(s / 60)}m ago`;
    }

    function formatMotd(d) {
      const clean = d?.motd?.clean;
      if (Array.isArray(clean) && clean.length) return clean.join("\n");
      const raw = d?.motd?.raw;
      if (Array.isArray(raw) && raw.length) return raw.join("\n");
      return "—";
    }

    async function loadStatus() {
      setStatus(statusDotHome, statusTextHome, null);
      statusTextStatus.textContent = "Checking…";
      pingBadgeHome.textContent = "Ping: —";
      apiPing.textContent = "—";

      const startTime = performance.now();
      try {
        const d = await fetchJsonWithTimeout(`https://api.mcsrvstat.us/3/${SERVER}`, 6500);
        const pingMs = Math.max(0, Math.round(performance.now() - startTime));
        lastData = d;
        lastUpdatedAt = Date.now();

        const online = !!d.online;
        // uptime history is global (worker) — no per-visit recording here
        setStatus(statusDotHome, statusTextHome, online);
        statusTextStatus.textContent = online ? "Online" : "Offline";

        const on = d?.players?.online ?? 0;
        const max = d?.players?.max ?? 0;

        playersTextHome.textContent = `Players: ${on}/${max || "—"}`;
        playersTextStatus.textContent = `${on}/${max || "—"}`;

        let pct = 0;
        if (max && max > 0) pct = Math.min(100, Math.round((on / max) * 100));
        playerFillHome.style.width = pct + "%";
        playerFillStatus.style.width = pct + "%";

        const ver = d?.protocol?.name || d?.version || "—";
        serverVerHome.textContent = ver;
        serverVerStatus.textContent = ver;

        const motd = formatMotd(d);
        motdTextHome.textContent = motd;
        motdTextStatus.textContent = motd;

        apiCache.textContent = d?.debug?.cachehit ? "hit" : "miss";
        apiPing.textContent = `~${pingMs}ms`;
        pingBadgeHome.textContent = `Ping: ~${pingMs}ms`;
        apiQuery.textContent = d?.debug?.query ? "ok" : "no";

        serverIpStatus.textContent = SERVER;
        serverPortStatus.textContent = String(d?.port ?? 25567);

        const hasList = Array.isArray(d?.players?.list) && d.players.list.length > 0;
        const hint = online ? (hasList ? "Available" : "May be hidden") : "Offline";
        playersBtnHome.textContent = `View Players (${hint})`;
        playersBtnStatus.textContent = `View Players (${hint})`;

      } catch {
        // uptime history is global (worker) — no per-visit recording here
        statusTextHome.textContent = "Unavailable";
        statusTextStatus.textContent = "Unavailable";
        playersTextHome.textContent = "Players: —/—";
        playersTextStatus.textContent = "—/—";
        playerFillHome.style.width = "0%";
        playerFillStatus.style.width = "0%";
        serverVerHome.textContent = "—";
        serverVerStatus.textContent = "—";
        motdTextHome.textContent = "Could not load (network/API blocked)";
        motdTextStatus.textContent = "Could not load (network/API blocked)";
        apiCache.textContent = "—";
        apiPing.textContent = "—";
        pingBadgeHome.textContent = "Ping: —";
        apiQuery.textContent = "—";
      }

      setUpdatedLabel(updatedTextHome);
      setUpdatedLabel(updatedTextStatus);
    }

    async function loadLatest() {
      try {
        const j = await fetchJsonWithTimeout("https://piston-meta.mojang.com/mc/game/version_manifest_v2.json", 6500);
        const latest = j?.latest?.release || "Latest";
        latestVerHome.textContent = latest;
        latestVerStatus.textContent = latest;
      } catch {
        latestVerHome.textContent = "Latest";
        latestVerStatus.textContent = "Latest";
      }
    }

    function setIcon() {
      const url = `https://api.mcsrvstat.us/icon/${SERVER}`;
      srvIcon.src = url;
      favicon.href = url;
      srvIcon.onerror = () => srvIcon.style.display = "none";
    }

    route();
    setIcon();
    renderUptime();
    loadStatus();
    loadLatest();

    setInterval(loadStatus, 120000);
    setInterval(loadLatest, 120000);
    setInterval(renderUptime, 3600000);

    setInterval(() => {
      setUpdatedLabel(updatedTextHome);
      setUpdatedLabel(updatedTextStatus);
    }, 1000);
  </script>
</body>
</html>
